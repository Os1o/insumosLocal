<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Solicitud de Papeler√≠a</title>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: #f5f5f5;
        }

        .preview-container {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .documento-header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #333;
            padding-bottom: 1rem;
        }

        .documento-header h1 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .documento-header h2 {
            margin: 0.25rem 0;
            font-size: 1rem;
            font-weight: normal;
        }

        .solicitud-info {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        .salida-info {
            border: 2px solid #333;
            padding: 0.5rem;
            text-align: center;
        }

        .salida-numero {
            font-size: 2rem;
            font-weight: bold;
            letter-spacing: 0.5rem;
        }

        .cargo-section {
            margin-bottom: 1rem;
        }

        .cargo-line {
            border-bottom: 1px solid #333;
            display: inline-block;
            min-width: 300px;
            margin-left: 1rem;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .items-table th,
        .items-table td {
            border: 1px solid #333;
            padding: 0.5rem;
            text-align: left;
            vertical-align: top;
        }

        .items-table th {
            background: #f0f0f0;
            font-weight: bold;
            text-align: center;
        }

        .descripcion-col {
            width: 60%;
        }

        .unidad-col {
            width: 20%;
            text-align: center;
        }

        .cantidad-col {
            width: 20%;
            text-align: center;
        }

        .autorizacion-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
            border-top: 2px solid #333;
            padding-top: 1rem;
        }

        .autorizo-box {
            border: 2px solid #333;
            padding: 1rem;
            height: 120px;
        }

        .autorizo-box h3 {
            margin: 0 0 1rem 0;
            text-align: center;
            font-size: 1rem;
        }

        .firma-lines {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .firma-line {
            border-bottom: 1px solid #333;
            padding-bottom: 0.25rem;
            text-align: center;
            font-size: 0.9rem;
        }

        .oficina-section {
            text-align: right;
            padding-top: 1rem;
        }

        .fecha-input {
            border-bottom: 2px solid #333;
            border-top: none;
            border-left: none;
            border-right: none;
            background: transparent;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            padding: 0.25rem;
            min-width: 150px;
        }

        .controls {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .controls h3 {
            margin-top: 0;
            color: #333;
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin-right: 1rem;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .item-row {
            display: grid;
            grid-template-columns: 3fr 1fr 1fr auto;
            gap: 0.5rem;
            align-items: end;
            margin-bottom: 0.5rem;
        }

        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }

        .preview-item {
            font-size: 0.9rem;
            line-height: 1.2;
        }
    </style>
</head>

<body>
    <div class="controls">
        <h3>üìÑ Generador de Solicitud de Papeler√≠a</h3>

        <div class="grid-2">
            <div class="form-group">
                <label>Nombre del Solicitante:</label>
                <input type="text" id="nombreSolicitante" placeholder="Ej: Barbara Arceli Romero Mejia">
            </div>
            <div class="form-group">
                <label>Departamento/√Årea:</label>
                <input type="text" id="departamento" placeholder="Ej: Coordinaci√≥n Administrativa">
            </div>
        </div>

        <div class="grid-2">
            <div class="form-group">
                <label>Con Cargo a:</label>
                <input type="text" id="cargoA" placeholder="Ej: Partida CEPS">
            </div>
            <div class="form-group">
                <label>N√∫mero de Salida:</label>
                <input type="text" id="numeroSalida" placeholder="Ej: 666" maxlength="3">
            </div>
        </div>

        <div class="form-group">
            <label>Fecha:</label>
            <input type="date" id="fechaSolicitud">
        </div>

        <h4>Items Solicitados:</h4>
        <div id="itemsContainer">
            <div class="item-row">
                <input type="text" placeholder="Descripci√≥n del item" class="item-descripcion">
                <input type="text" placeholder="Unidad" class="item-unidad" maxlength="10">
                <input type="number" placeholder="Cantidad" class="item-cantidad" min="1">
                <button type="button" class="btn btn-small" onclick="eliminarItem(this)">üóëÔ∏è</button>
            </div>
        </div>

        <button type="button" class="btn btn-secondary btn-small" onclick="agregarItem()">‚ûï Agregar Item</button>

        <hr style="margin: 1.5rem 0;">

        <button type="button" class="btn" onclick="actualizarPreview()">üëÅÔ∏è Vista Previa</button>
        <button type="button" class="btn" onclick="generarPDF()">üìÑ Generar PDF</button>
    </div>

    <div class="preview-container">
        <div class="documento-header">
            <h1>Direcci√≥n Jur√≠dica</h1>
            <h2 id="preview-departamento">Coordinaci√≥n Administrativa</h2>
            <h2>Solicitud de Papeler√≠a y Art√≠culos de Oficina</h2>
        </div>

        <div class="solicitud-info">
            <div>
                <div class="cargo-section">
                    <strong>Con Cargo a</strong>
                    <span class="cargo-line" id="preview-cargo">Partida CEPS</span>
                </div>
            </div>
            <div class="salida-info">
                <div><strong>Salida de Almac√©n N¬∞</strong></div>
                <div class="salida-numero" id="preview-numero">666</div>
                <div>Fecha</div>
                <input type="text" class="fecha-input" id="preview-fecha" readonly>
                <div style="margin-top: 0.5rem;"><strong>U P</strong></div>
            </div>
        </div>

        <table class="items-table">
            <thead>
                <tr>
                    <th class="descripcion-col">Descripci√≥n</th>
                    <th class="unidad-col">Unidad</th>
                    <th class="cantidad-col">Cantidad</th>
                </tr>
            </thead>
            <tbody id="preview-items">
                <tr>
                    <td class="preview-item">Engrapadora y Engrap auditor√≠a y Grapas</td>
                    <td class="unidad-col">Pz</td>
                    <td class="cantidad-col">19</td>
                </tr>
                <!-- Se llenan din√°micamente -->
            </tbody>
        </table>

        <div class="autorizacion-section">
            <div class="autorizo-box">
                <h3>Autoriz√≥</h3>
                <div class="firma-lines">
                    <div>
                        <div style="height: 40px;"></div>
                        <div class="firma-line">Fecha</div>
                    </div>
                    <div>
                        <div style="height: 40px;"></div>
                        <div class="firma-line">Matr√≠cula</div>
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <div style="height: 40px;"></div>
                    <div class="firma-line" id="preview-nombre">Barbara Arceli Romero Mejia</div>
                    <div style="text-align: right; margin-top: 0.25rem; font-size: 0.8rem;">Firma</div>
                </div>
            </div>
            <div class="oficina-section">
                <div><strong>Oficio</strong></div>
                <div style="height: 80px; border-bottom: 1px solid #333; margin: 1rem 0;"></div>
                <div><strong>Fecha</strong></div>
                <div style="height: 40px; border-bottom: 1px solid #333; margin-top: 0.5rem;"></div>
            </div>
        </div>
    </div>

    <script>
        // Inicializar fecha actual
        document.getElementById('fechaSolicitud').value = new Date().toISOString().split('T')[0];

        function agregarItem() {
            const container = document.getElementById('itemsContainer');
            const itemRow = document.createElement('div');
            itemRow.className = 'item-row';
            itemRow.innerHTML = `
                <input type="text" placeholder="Descripci√≥n del item" class="item-descripcion">
                <input type="text" placeholder="Unidad" class="item-unidad" maxlength="10">
                <input type="number" placeholder="Cantidad" class="item-cantidad" min="1">
                <button type="button" class="btn btn-small" onclick="eliminarItem(this)">üóëÔ∏è</button>
            `;
            container.appendChild(itemRow);
        }

        function eliminarItem(button) {
            if (document.querySelectorAll('.item-row').length > 1) {
                button.parentElement.remove();
            } else {
                alert('Debe haber al menos un item');
            }
        }

        function actualizarPreview() {
            // Actualizar informaci√≥n b√°sica
            document.getElementById('preview-departamento').textContent =
                document.getElementById('departamento').value || 'Coordinaci√≥n Administrativa';

            document.getElementById('preview-cargo').textContent =
                document.getElementById('cargoA').value || 'Partida CEPS';

            document.getElementById('preview-numero').textContent =
                document.getElementById('numeroSalida').value || '666';

            document.getElementById('preview-nombre').textContent =
                document.getElementById('nombreSolicitante').value || 'Barbara Arceli Romero Mejia';

            // Formatear fecha
            const fecha = document.getElementById('fechaSolicitud').value;
            if (fecha) {
                const fechaObj = new Date(fecha);
                const fechaFormateada = fechaObj.toLocaleDateString('es-MX');
                document.getElementById('preview-fecha').value = fechaFormateada;
            }

            // Actualizar items
            const itemsContainer = document.getElementById('preview-items');
            itemsContainer.innerHTML = '';

            const itemRows = document.querySelectorAll('.item-row');
            itemRows.forEach(row => {
                const descripcion = row.querySelector('.item-descripcion').value;
                const unidad = row.querySelector('.item-unidad').value;
                const cantidad = row.querySelector('.item-cantidad').value;

                if (descripcion && unidad && cantidad) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="preview-item">${descripcion}</td>
                        <td class="unidad-col">${unidad}</td>
                        <td class="cantidad-col">${cantidad}</td>
                    `;
                    itemsContainer.appendChild(tr);
                }
            });

            // Si no hay items, agregar fila vac√≠a
            if (itemsContainer.children.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="preview-item">Engrapadora y Engrap auditor√≠a y Grapas</td>
                    <td class="unidad-col">Pz</td>
                    <td class="cantidad-col">19</td>
                `;
                itemsContainer.appendChild(tr);
            }
        }

        function generarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Configuraci√≥n
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 20;
            const contentWidth = pageWidth - (margin * 2);

            let y = margin;

            // Header
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('Direcci√≥n Jur√≠dica', pageWidth / 2, y, { align: 'center' });
            y += 7;

            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            const departamento = document.getElementById('departamento').value || 'Coordinaci√≥n Administrativa';
            doc.text(departamento, pageWidth / 2, y, { align: 'center' });
            y += 7;

            doc.setFont('helvetica', 'bold');
            doc.text('Solicitud de Papeler√≠a y Art√≠culos de Oficina', pageWidth / 2, y, { align: 'center' });
            y += 15;

            // L√≠nea separadora
            doc.line(margin, y, pageWidth - margin, y);
            y += 10;

            // Con Cargo a y Salida
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('Con Cargo a:', margin, y);
            doc.setFont('helvetica', 'normal');
            const cargoA = document.getElementById('cargoA').value || 'Partida CEPS';
            doc.text(cargoA, margin + 25, y);

            // Cuadro de salida (derecha)
            const cuadroX = pageWidth - margin - 50;
            doc.rect(cuadroX, y - 8, 50, 25);
            doc.setFont('helvetica', 'bold');
            doc.text('Salida de', cuadroX + 25, y - 3, { align: 'center' });
            doc.text('Almac√©n N¬∞', cuadroX + 25, y + 2, { align: 'center' });

            const numeroSalida = document.getElementById('numeroSalida').value || '666';
            doc.setFontSize(16);
            doc.text(numeroSalida, cuadroX + 25, y + 10, { align: 'center' });

            doc.setFontSize(8);
            const fecha = document.getElementById('fechaSolicitud').value;
            if (fecha) {
                const fechaObj = new Date(fecha);
                const fechaFormateada = fechaObj.toLocaleDateString('es-MX');
                doc.text('Fecha: ' + fechaFormateada, cuadroX + 25, y + 16, { align: 'center' });
            }

            y += 30;

            // Tabla de items
            doc.setFontSize(10);
            const tableHeaders = ['Descripci√≥n', 'Unidad', 'Cantidad'];
            const colWidths = [contentWidth * 0.7, contentWidth * 0.15, contentWidth * 0.15];

            // Headers de tabla
            doc.setFont('helvetica', 'bold');
            let currentX = margin;
            tableHeaders.forEach((header, index) => {
                doc.rect(currentX, y, colWidths[index], 8);
                doc.text(header, currentX + colWidths[index] / 2, y + 5, { align: 'center' });
                currentX += colWidths[index];
            });
            y += 8;

            // Items de la tabla
            doc.setFont('helvetica', 'normal');
            const itemRows = document.querySelectorAll('.item-row');
            let hasItems = false;

            itemRows.forEach(row => {
                const descripcion = row.querySelector('.item-descripcion').value;
                const unidad = row.querySelector('.item-unidad').value;
                const cantidad = row.querySelector('.item-cantidad').value;

                if (descripcion && unidad && cantidad) {
                    hasItems = true;
                    currentX = margin;

                    // Calcular altura necesaria para la descripci√≥n
                    const descripcionLines = doc.splitTextToSize(descripcion, colWidths[0] - 4);
                    const rowHeight = Math.max(6, descripcionLines.length * 4);

                    // Dibujar celdas
                    doc.rect(currentX, y, colWidths[0], rowHeight);
                    doc.rect(currentX + colWidths[0], y, colWidths[1], rowHeight);
                    doc.rect(currentX + colWidths[0] + colWidths[1], y, colWidths[2], rowHeight);

                    // Contenido
                    doc.text(descripcionLines, currentX + 2, y + 4);
                    doc.text(unidad, currentX + colWidths[0] + colWidths[1] / 2, y + rowHeight / 2, { align: 'center' });
                    doc.text(cantidad.toString(), currentX + colWidths[0] + colWidths[1] + colWidths[2] / 2, y + rowHeight / 2, { align: 'center' });

                    y += rowHeight;
                }
            });

            // Si no hay items, agregar filas vac√≠as
            if (!hasItems) {
                for (let i = 0; i < 10; i++) {
                    currentX = margin;
                    doc.rect(currentX, y, colWidths[0], 6);
                    doc.rect(currentX + colWidths[0], y, colWidths[1], 6);
                    doc.rect(currentX + colWidths[0] + colWidths[1], y, colWidths[2], 6);
                    y += 6;
                }
            }

            y += 15;

            // Secci√≥n de autorizaci√≥n
            const boxWidth = (contentWidth - 10) / 2;
            const boxHeight = 40;

            // Cuadro "Autoriz√≥"
            doc.rect(margin, y, boxWidth, boxHeight);
            doc.setFont('helvetica', 'bold');
            doc.text('Autoriz√≥', margin + boxWidth / 2, y + 8, { align: 'center' });

            // L√≠neas de firma
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(8);
            doc.line(margin + 5, y + 18, margin + boxWidth / 2 - 5, y + 18);
            doc.text('Fecha', margin + boxWidth / 4, y + 22, { align: 'center' });

            doc.line(margin + boxWidth / 2 + 5, y + 18, margin + boxWidth - 5, y + 18);
            doc.text('Matr√≠cula', margin + boxWidth * 3 / 4, y + 22, { align: 'center' });

            // L√≠nea del nombre
            doc.line(margin + 5, y + 32, margin + boxWidth - 5, y + 32);
            const nombreSolicitante = document.getElementById('nombreSolicitante').value || 'Barbara Arceli Romero Mejia';
            doc.text(nombreSolicitante, margin + boxWidth / 2, y + 36, { align: 'center' });
            doc.text('Firma', margin + boxWidth - 10, y + 38, { align: 'right' });

            // Cuadro "Oficio"
            const oficioDY = y;
            doc.rect(margin + boxWidth + 10, oficioDY, boxWidth, boxHeight);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(10);
            doc.text('Oficio', margin + boxWidth + 10 + boxWidth / 2, oficioDY + 8, { align: 'center' });

            // L√≠neas del oficio
            doc.line(margin + boxWidth + 15, oficioDY + 25, margin + boxWidth + 10 + boxWidth - 5, oficioDY + 25);
            doc.setFont('helvetica', 'bold');
            doc.text('Fecha', margin + boxWidth + 10 + boxWidth / 2, oficioDY + 35, { align: 'center' });
            doc.line(margin + boxWidth + 15, oficioDY + 38, margin + boxWidth + 10 + boxWidth - 5, oficioDY + 38);

            // Generar nombre del archivo
            const fechaArchivo = new Date().toISOString().split('T')[0];
            const nombreArchivo = `Solicitud_Papeleria_${fechaArchivo}.pdf`;

            // Descargar
            doc.save(nombreArchivo);
        }

        // Actualizar preview al cargar
        document.addEventListener('DOMContentLoaded', actualizarPreview);

        // Auto-actualizar preview cuando cambien los campos
        document.querySelectorAll('input, select').forEach(input => {
            input.addEventListener('input', actualizarPreview);
        });
    </script>
</body>

</html>